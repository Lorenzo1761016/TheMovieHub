<body>
<div class="container">
    <div class="row">
        <div class="col-sm-5">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <strong id = "user"> <%= comment.username %> </strong> <span class="text-muted"><small>Submitted <%= time_ago_in_words(comment.created_at) %> ago</small></span>
                    <% if current_user.username == comment.username %> 
                        <%= link_to "Elimina", comment, :method => :delete,:class => "link"%> 
                    <% end %>
                   <a id = 'a_<%= comment.id %>' > Rispondi </a>
                </div>
                <div class="panel-body">
                    <%= comment.body %>
                </div><!-- /panel-body -->
                <span class='parent-likes'>
                    <span class="like_count" <%= comment.id %>>
                        <%= comment.get_likes.size %> &#128591
                    </span>

                    <a>
                        <% if current_user.liked? comment %>
                            <div> <%= link_to like_comment_path(comment, 'unlike'), class: "preached-btn", method: :put, remote: :true do %> Dislike </div>
                            <% end %>
                        <% else %>
                          <div> <%= link_to like_comment_path(comment, 'like'), class: "preach-btn", method: :put, remote: :true do %> Like </div>
                          <% end %>
                        <% end %>
                    </a>
                </span>
            </div><!-- /panel panel-default -->
        </div><!-- /col-sm-5 -->
    </div>
</div>

 
   <div id = 'id_<%= comment.id %>' style = "display: none" >
        <%= form_for [comment, Comment.new] do |f| %>
            <%= f.text_area :body, placeholder: "Rispondi" %><br/>
            <%= f.submit "Rispondi"  %>
        <% end %>
    </div> 


  <ul>
      <%= render partial: 'comment', collection: comment.comments %>
  </ul> 
</body>

<script>
$('.preached-btn').on('ajax:succes', function(){
    $(this).parent().parent().find('.like_count')
        .html('<%= comment.get_likes.size %> &#128591');
        $(this).closest('.preached-btn').html('Preach');
});

$('.preach-btn').on('ajax:success', function(){
    $(this).parent().parent().find('.like_count')
    .html('<%= comment.get_likes.size %> &#128591');
    $(this).closest('.preach-btn').html('Preached');
});
    $(document).ready(function() {
        $('#a_<%= comment.id %>').click(function(event){
            event.preventDefault();
            $('#id_<%= comment.id%>').toggle();
        });
    });   
</script> 
